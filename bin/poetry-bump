#!/usr/bin/env bash

set -e

error () {
    echo "$1" >&2
    exit 1
}

[[ -z "$1" ]] && error "Specify the version number or the rule to update the version."

git diff --quiet || error "Git working tree is dirty."

[[ -f pyproject.toml ]] || error "'pyproject.toml' doesn't exist."
[[ ! -f .bumpversion.cfg ]] || error "'.bump2version.cfg' exists."

poetry version "$1"
version="$(poetry version -s)"

git add pyproject.toml
git commit -q -m "Bump version $version"
git tag -a -m "Version $version" "$version"
