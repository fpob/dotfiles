#!/usr/bin/env python3

import click
import hashlib
import os

@click.command()
@click.argument("src", nargs=-1, type=click.Path(exists=True, dir_okay=False, resolve_path=True))
@click.argument("dst", nargs=1, type=click.Path(exists=True, file_okay=False, resolve_path=True))
def md5ln(src, dst):
    """
    Vytvoří symbolické odkazy na zadané soubory, které pojmenuje podle MD5
    kontrolních součtů daných souborů.
    """
    with click.progressbar(src, item_show_func=str) as bar:
        for file in bar:
            ext = os.path.splitext(file)[1]
            md5 = hashlib.md5()
            with open(file, "rb") as f:
                while True:
                    chunk = f.read(2048)
                    if not chunk:
                        break
                    md5.update(chunk)
            new = os.path.join(dst, md5.hexdigest() + ext)
            os.symlink(file, new)

if __name__ == "__main__":
    md5ln()
