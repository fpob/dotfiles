#!/usr/bin/env bash

LANG=C

texfile_count_char () {
    cat "$1" \
        | detex \
        | grep -v '^\s*$' \
        | tr "\n" ' ' \
        | sed -re 's/(\s)\s*/\1/g' \
        | wc -m
}

calc () {
    bc <<EOF
scale = 2
$1 / 1800
EOF
}

sum=0

for f in "$@" ; do
    c=`texfile_count_char "$f"`
    sum=$(( sum + c ))

    [[ $# -gt 1 ]] \
        && printf "%8.2f  %s\n" `calc $c` "$f" \
        || printf "%.2f\n" `calc $c`
done

[[ $# -gt 1 ]] && printf -- " --------------\n%8.2f\n" `calc $sum`

true
